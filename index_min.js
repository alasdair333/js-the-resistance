function Player(e,t){this.name=e,this.socket=t}function Room(e,t,n,o,a){this.name=e,this.password=t,this.owner=n,this.players=o,this.game=a,this.state=a.stateName}Array.prototype.shuffle=function(){var e,t,n=this.length;if(0==n)return this;for(;--n;)e=Math.floor(Math.random()*(n+1)),t=this[n],this[n]=this[e],this[e]=t;return this};var Resistance=function(){this.state=0,this.players=null,this.characters=[];var e={name:"init",func:function(e){for(var t=0,n=0;n<e.players.length;n++)e.players[n].socket.emit("chat message","TheGame","Lets play a game: "+e.players[n].name);switch(e.players.length){case 5:case 6:t=2;break;case 7:case 8:case 9:t=3;break;case 10:t=4}for(var n=0;n<e.players.length;n++)t>0?(e.characters.push("spy"),t--):e.characters.push("Resistance");e.characters.shuffle();for(var n=0;n<e.players.length;n++);e.state++}},t={name:"dealCharacters",func:function(){}},n={name:"revelSpies",func:function(){}},o={name:"teamLeader",func:function(){}},a={name:"teamBuild",func:function(){}},s={name:"voteTeam",func:function(){}},r={name:"mission",func:function(){}},i={name:"missionEnd",func:function(){}},c={name:"endGame",func:function(){}};this.ResistanceGameState=[e,t,n,o,a,s,r,i,c],this.stateName=this.ResistanceGameState[this.state].name,this.processEvent=function(t){switch(t.event){case"start game":e.func(this);break;default:console.log("Error")}}},app=require("express")(),http=require("http").Server(app),io=require("socket.io")(http),rooms=[];app.get("/",function(e,t){for(var n="Please connect to a chatroom: \n",o=0;o<rooms.length;o++)n+="Room: "+rooms[o].name+" Current state: "+rooms[o].state+"\n";t.send(n)}),app.get("/:room",function(e,t){t.sendfile("Client/index.html")}),app.get("/games/:file",function(e,t){console.log("Getting "+e.param("file")),t.sendfile("games/"+e.param("file"))}),io.on("connection",function(e){e.on("join room",function(t,n,o){for(var a=!1,s=!1,r=null,i=new Player(t,e),c=0;c<rooms.length;c++)if(rooms[c].name==n){a=!0,r=rooms[c];break}if(a)r.password==o?(r.players.push(i),s=!0):e.emit("join failed","Password incorrect");else{var m=new Resistance,h=new Room(n,o,e,[],m);m.players=h.players,h.players.push(i),rooms.push(h),r=h,s=!0}s?(e.username=t,e.room=n,e.join(n),e.emit("updateroom","You have connected to "+n),e.broadcast.to(e.room).emit("updateroom",t+" has connected to room")):e.emit("join failed","Failed to join room")}),e.on("leave room",function(){e.leave(e.room)}),e.on("chat message",function(t){io.to(e.room).emit("chat message",e.username,t)}),e.on("game event",function(e,t){for(var n=0;n<rooms.length;n++)rooms[n].name==e&&rooms[n].game.processEvent(t)})}),http.listen(3e3,function(){console.log("listening on *:3000")});